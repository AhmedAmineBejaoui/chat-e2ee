# Environment Variables Configuration

## Required Environment Variables

Copy this file to `.env` and update the values for your deployment.

### Development
```env
NODE_ENV=development
PORT=3001
CLIENT_ORIGIN=http://localhost:3000
CHAT_LINK_DOMAIN=http://localhost:3000
PUBLIC_SERVER_URL=http://localhost:3001
```

### Production - Render
```env
NODE_ENV=production
PORT=10000
CLIENT_ORIGIN=https://YOUR_APP_NAME.onrender.com
CHAT_LINK_DOMAIN=https://YOUR_APP_NAME.onrender.com
PUBLIC_SERVER_URL=https://YOUR_APP_NAME.onrender.com

# Optional: MongoDB for persistence
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/chat-e2ee
MONGO_DB_NAME=chat-e2ee

# Security settings
MAX_JSON_PAYLOAD=25mb
SOCKET_MAX_PAYLOAD_BYTES=5242880
ENFORCE_HTTPS=true
HSTS_MAX_AGE=31536000
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=120
```

### Production - Firebase + Render Backend
```env
# Backend on Render
NODE_ENV=production
PORT=10000
CLIENT_ORIGIN=https://chat-e2ee-7282d.web.app,https://chat-e2ee-7282d.firebaseapp.com
CHAT_LINK_DOMAIN=https://chat-e2ee-7282d.web.app
PUBLIC_SERVER_URL=https://YOUR_RENDER_APP.onrender.com

# Client environment (client/.env.production)
REACT_APP_API_URL=https://YOUR_RENDER_APP.onrender.com
REACT_APP_SOCKET_URL=https://YOUR_RENDER_APP.onrender.com
```

## Environment Variables Explained

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `NODE_ENV` | Environment mode | Yes | `production` |
| `PORT` | Server port | Yes | `10000` (Render), `3001` (local) |
| `CLIENT_ORIGIN` | CORS allowed origins (comma-separated) | Yes | `https://app.onrender.com` |
| `CHAT_LINK_DOMAIN` | Domain for generated chat links | Yes | `https://app.onrender.com` |
| `PUBLIC_SERVER_URL` | Public URL for file uploads | Yes | `https://app.onrender.com` |
| `MONGO_URI` | MongoDB connection string | No | `mongodb+srv://...` |
| `MONGO_DB_NAME` | MongoDB database name | No | `chat-e2ee` |
| `MAX_JSON_PAYLOAD` | Max JSON request size | No | `25mb` |
| `SOCKET_MAX_PAYLOAD_BYTES` | Max WebSocket payload | No | `5242880` |
| `ENFORCE_HTTPS` | Force HTTPS redirects | No | `true` |
| `HSTS_MAX_AGE` | HSTS header max age | No | `31536000` |
| `RATE_LIMIT_WINDOW_MS` | Rate limit window | No | `60000` |
| `RATE_LIMIT_MAX` | Max requests per window | No | `120` |
| `SSL_CERT_FILE` | SSL certificate (local dev) | No | `client/certs/devcert.pem` |
| `SSL_KEY_FILE` | SSL key (local dev) | No | `client/certs/devkey.pem` |

## Setting Environment Variables

### Render
1. Go to your service dashboard
2. Navigate to **Environment** tab
3. Click **Add Environment Variable**
4. Add each variable from the Production - Render section above

### Firebase (Client-side)
Create `client/.env.production`:
```env
REACT_APP_API_URL=https://YOUR_BACKEND_URL
REACT_APP_SOCKET_URL=https://YOUR_BACKEND_URL
```

### Local Development
Create `.env` in the root directory:
```env
# Copy from .env.sample and update values
PORT=3001
CLIENT_ORIGIN=http://localhost:3000
CHAT_LINK_DOMAIN=http://localhost:3000
```

## Security Notes

⚠️ **Never commit `.env` files to version control**

- Use `.env.sample` as a template
- Store sensitive credentials in deployment platform's environment variables
- Rotate credentials regularly
- Use different credentials for development and production
